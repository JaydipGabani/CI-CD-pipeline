- job:
    name: "{{checkbox_job_name}}"
    description: 'automatically generated test'
    project-type: freestyle
    builders:
      - shell: |
          FLAG=0
          if [ "$(ls -A /var/lib/jenkins/workspace/checkbox_job/)" ]; then
              cd checkbox.io
              git pull origin master
              FLAG=1
              
          else
              git clone https://github.com/chrisparnin/checkbox.io.git
              cd checkbox.io
          fi
          sudo npm install
          cd server-side/site
          sudo npm install
          sudo systemctl start mongod
          forever stopall
          BUILD_ID=dontKillMe forever -a -l myforever.log server.js &
          npm test
    publishers:
      - postbuildscript:
          builders:
            - build-steps:
              - shell: 'ls'
